<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Audit System - Architecture Diagram</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a202c;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        
        h1 {
            text-align: center;
            color: #1a202c;
            margin-bottom: 10px;
            font-size: 32px;
            font-weight: 700;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 50px;
            font-size: 16px;
        }
        
        svg {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .component-box {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .component-box:hover {
            filter: brightness(1.1);
        }
        
        .arrow-line {
            stroke-width: 3;
            fill: none;
            marker-end: url(#arrowhead);
        }
        
        .arrow-bidirectional {
            marker-start: url(#arrowhead-reverse);
        }
        
        text {
            font-family: 'Segoe UI', sans-serif;
        }
        
        .component-title {
            font-weight: 600;
            font-size: 16px;
        }
        
        .component-detail {
            font-size: 13px;
            fill: #4a5568;
        }
        
        .flow-label {
            font-size: 12px;
            font-weight: 600;
            fill: #2d3748;
        }
        
        .layer-label {
            font-size: 14px;
            font-weight: 700;
            fill: #718096;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .info-panel {
            margin-top: 40px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .info-card h3 {
            font-size: 18px;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .info-card ul {
            list-style: none;
            padding: 0;
        }
        
        .info-card li {
            padding: 8px 0;
            font-size: 14px;
            line-height: 1.6;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .info-card li:last-child {
            border-bottom: none;
        }
        
        .info-card li:before {
            content: "‚úì ";
            margin-right: 8px;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .info-panel {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Chat Audit System Architecture</h1>
        <p class="subtitle">End-to-End Flow: React ‚Üí Quarkus Proxy ‚Üí Third-Party API ‚Üí Audit Storage</p>
        
        <svg viewBox="0 0 1400 1200" xmlns="http://www.w3.org/2000/svg">
            <!-- Define markers for arrows -->
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#4299e1" />
                </marker>
                <marker id="arrowhead-reverse" markerWidth="10" markerHeight="10" refX="1" refY="3" orient="auto">
                    <polygon points="10 0, 0 3, 10 6" fill="#9f7aea" />
                </marker>
                <marker id="arrowhead-green" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#48bb78" />
                </marker>
                <marker id="arrowhead-orange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 10 3, 0 6" fill="#ed8936" />
                </marker>
                
                <!-- Gradient definitions -->
                <linearGradient id="grad-frontend" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#48bb78;stop-opacity:0.2" />
                    <stop offset="100%" style="stop-color:#48bb78;stop-opacity:0.05" />
                </linearGradient>
                <linearGradient id="grad-backend" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#4299e1;stop-opacity:0.2" />
                    <stop offset="100%" style="stop-color:#4299e1;stop-opacity:0.05" />
                </linearGradient>
                <linearGradient id="grad-storage" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#ed8936;stop-opacity:0.2" />
                    <stop offset="100%" style="stop-color:#ed8936;stop-opacity:0.05" />
                </linearGradient>
                <linearGradient id="grad-external" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#9f7aea;stop-opacity:0.2" />
                    <stop offset="100%" style="stop-color:#9f7aea;stop-opacity:0.05" />
                </linearGradient>
                <linearGradient id="grad-queue" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" style="stop-color:#f6ad55;stop-opacity:0.2" />
                    <stop offset="100%" style="stop-color:#f6ad55;stop-opacity:0.05" />
                </linearGradient>
            </defs>
            
            <!-- Layer Labels -->
            <text x="50" y="80" class="layer-label">FRONTEND LAYER</text>
            <text x="50" y="280" class="layer-label">API GATEWAY</text>
            <text x="50" y="540" class="layer-label">MESSAGE QUEUE</text>
            <text x="50" y="740" class="layer-label">AUDIT SERVICE</text>
            <text x="50" y="980" class="layer-label">STORAGE LAYER</text>
            
            <!-- FRONTEND: React Application -->
            <g class="component-box">
                <rect x="500" y="100" width="400" height="140" rx="10" fill="url(#grad-frontend)" stroke="#48bb78" stroke-width="3"/>
                <text x="700" y="140" text-anchor="middle" class="component-title" fill="#2d3748">React Application</text>
                <text x="700" y="165" text-anchor="middle" class="component-detail">‚Ä¢ Chat Interface</text>
                <text x="700" y="185" text-anchor="middle" class="component-detail">‚Ä¢ SSE/Stream Handler</text>
                <text x="700" y="205" text-anchor="middle" class="component-detail">‚Ä¢ Session Management</text>
                <text x="700" y="225" text-anchor="middle" class="component-detail">‚Ä¢ User Context (org_id, user_id)</text>
            </g>
            
            <!-- Arrow 1: React to Quarkus Proxy -->
            <line x1="700" y1="240" x2="700" y2="290" class="arrow-line" stroke="#48bb78" marker-end="url(#arrowhead-green)"/>
            <text x="720" y="270" class="flow-label">1. POST /api/chat</text>
            
            <!-- BACKEND: Quarkus Proxy Gateway -->
            <g class="component-box">
                <rect x="450" y="300" width="300" height="160" rx="10" fill="url(#grad-backend)" stroke="#4299e1" stroke-width="3"/>
                <text x="600" y="340" text-anchor="middle" class="component-title" fill="#2d3748">Quarkus Proxy Gateway</text>
                <text x="600" y="365" text-anchor="middle" class="component-detail">‚Ä¢ REST Endpoints</text>
                <text x="600" y="385" text-anchor="middle" class="component-detail">‚Ä¢ Request Validation</text>
                <text x="600" y="405" text-anchor="middle" class="component-detail">‚Ä¢ Auth & Rate Limiting</text>
                <text x="600" y="425" text-anchor="middle" class="component-detail">‚Ä¢ Stream Proxy</text>
                <text x="600" y="445" text-anchor="middle" class="component-detail">‚Ä¢ Event Publisher</text>
            </g>
            
            <!-- EXTERNAL: Third-Party Chat API -->
            <g class="component-box">
                <rect x="950" y="300" width="300" height="160" rx="10" fill="url(#grad-external)" stroke="#9f7aea" stroke-width="3"/>
                <text x="1100" y="340" text-anchor="middle" class="component-title" fill="#2d3748">Third-Party Chat API</text>
                <text x="1100" y="365" text-anchor="middle" class="component-detail">‚Ä¢ OpenAI / Azure OpenAI</text>
                <text x="1100" y="385" text-anchor="middle" class="component-detail">‚Ä¢ Anthropic Claude</text>
                <text x="1100" y="405" text-anchor="middle" class="component-detail">‚Ä¢ Google Gemini</text>
                <text x="1100" y="425" text-anchor="middle" class="component-detail">‚Ä¢ Streaming Response</text>
                <text x="1100" y="445" text-anchor="middle" class="component-detail">‚Ä¢ Token Counting</text>
            </g>
            
            <!-- Arrow 2: Proxy to Third-Party (bidirectional) -->
            <line x1="750" y1="380" x2="950" y2="380" class="arrow-line arrow-bidirectional" stroke="#9f7aea" marker-end="url(#arrowhead)" marker-start="url(#arrowhead-reverse)"/>
            <text x="850" y="365" text-anchor="middle" class="flow-label">2. Forward Request</text>
            <text x="850" y="405" text-anchor="middle" class="flow-label">3. Stream Response</text>
            
            <!-- Arrow 3: Proxy back to React (response stream) -->
            <path d="M 450 350 Q 350 350, 350 170 L 500 170" class="arrow-line" stroke="#48bb78" marker-end="url(#arrowhead-green)"/>
            <text x="320" y="260" class="flow-label">4. Stream to UI</text>
            
            <!-- Arrow 4: Proxy to Message Queue -->
            <line x1="600" y1="460" x2="600" y2="550" class="arrow-line" stroke="#4299e1"/>
            <text x="620" y="510" class="flow-label">5. Publish Event</text>
            
            <!-- MESSAGE QUEUE: Kafka/RabbitMQ -->
            <g class="component-box">
                <rect x="450" y="560" width="300" height="120" rx="10" fill="url(#grad-queue)" stroke="#f6ad55" stroke-width="3"/>
                <text x="600" y="600" text-anchor="middle" class="component-title" fill="#2d3748">Message Queue</text>
                <text x="600" y="625" text-anchor="middle" class="component-detail">‚Ä¢ Kafka / RabbitMQ</text>
                <text x="600" y="645" text-anchor="middle" class="component-detail">‚Ä¢ Audit Events Topic</text>
                <text x="600" y="665" text-anchor="middle" class="component-detail">‚Ä¢ Async Processing</text>
            </g>
            
            <!-- Arrow 5: Message Queue to Audit Service -->
            <line x1="600" y1="680" x2="600" y2="750" class="arrow-line" stroke="#4299e1"/>
            <text x="620" y="720" class="flow-label">6. Consume Event</text>
            
            <!-- AUDIT SERVICE -->
            <g class="component-box">
                <rect x="450" y="760" width="300" height="160" rx="10" fill="url(#grad-backend)" stroke="#4299e1" stroke-width="3"/>
                <text x="600" y="800" text-anchor="middle" class="component-title" fill="#2d3748">Audit Service</text>
                <text x="600" y="825" text-anchor="middle" class="component-detail">‚Ä¢ Event Consumer</text>
                <text x="600" y="845" text-anchor="middle" class="component-detail">‚Ä¢ Data Transformation</text>
                <text x="600" y="865" text-anchor="middle" class="component-detail">‚Ä¢ Blob Upload</text>
                <text x="600" y="885" text-anchor="middle" class="component-detail">‚Ä¢ DB Persistence</text>
                <text x="600" y="905" text-anchor="middle" class="component-detail">‚Ä¢ Retry Logic</text>
            </g>
            
            <!-- Arrow 6: Audit Service to Azure Blob -->
            <line x1="750" y1="840" x2="950" y2="1040" class="arrow-line" stroke="#ed8936" marker-end="url(#arrowhead-orange)"/>
            <text x="870" y="930" class="flow-label">7. Upload Full Chat</text>
            
            <!-- Arrow 7: Audit Service to PostgreSQL -->
            <line x1="450" y1="840" x2="250" y2="1040" class="arrow-line" stroke="#ed8936" marker-end="url(#arrowhead-orange)"/>
            <text x="280" y="930" class="flow-label">8. Store Metadata</text>
            
            <!-- STORAGE: PostgreSQL -->
            <g class="component-box">
                <rect x="100" y="1000" width="300" height="180" rx="10" fill="url(#grad-storage)" stroke="#ed8936" stroke-width="3"/>
                <text x="250" y="1040" text-anchor="middle" class="component-title" fill="#2d3748">PostgreSQL</text>
                <text x="250" y="1065" text-anchor="middle" class="component-detail">‚Ä¢ conversation_id, session_id</text>
                <text x="250" y="1085" text-anchor="middle" class="component-detail">‚Ä¢ organization_id, user_id</text>
                <text x="250" y="1105" text-anchor="middle" class="component-detail">‚Ä¢ chatbot_id, model</text>
                <text x="250" y="1125" text-anchor="middle" class="component-detail">‚Ä¢ timestamps, token_count</text>
                <text x="250" y="1145" text-anchor="middle" class="component-detail">‚Ä¢ blob_reference</text>
                <text x="250" y="1165" text-anchor="middle" class="component-detail">‚Ä¢ metadata (JSONB)</text>
            </g>
            
            <!-- STORAGE: Azure Blob Storage -->
            <g class="component-box">
                <rect x="1000" y="1000" width="300" height="180" rx="10" fill="url(#grad-storage)" stroke="#ed8936" stroke-width="3"/>
                <text x="1150" y="1040" text-anchor="middle" class="component-title" fill="#2d3748">Azure Blob Storage</text>
                <text x="1150" y="1065" text-anchor="middle" class="component-detail">‚Ä¢ Full Prompt Text</text>
                <text x="1150" y="1085" text-anchor="middle" class="component-detail">‚Ä¢ Complete Response</text>
                <text x="1150" y="1105" text-anchor="middle" class="component-detail">‚Ä¢ Conversation History</text>
                <text x="1150" y="1125" text-anchor="middle" class="component-detail">‚Ä¢ Attachments</text>
                <text x="1150" y="1145" text-anchor="middle" class="component-detail">‚Ä¢ chats/YYYY/MM/DD/</text>
                <text x="1150" y="1165" text-anchor="middle" class="component-detail">  session-{id}.json</text>
            </g>
            
            <!-- Data Flow Numbers (Circled) -->
            <g>
                <circle cx="700" cy="260" r="18" fill="#48bb78" stroke="white" stroke-width="2"/>
                <text x="700" y="266" text-anchor="middle" fill="white" font-weight="bold" font-size="16">1</text>
            </g>
            <g>
                <circle cx="850" cy="350" r="18" fill="#9f7aea" stroke="white" stroke-width="2"/>
                <text x="850" y="356" text-anchor="middle" fill="white" font-weight="bold" font-size="16">2</text>
            </g>
            <g>
                <circle cx="350" cy="230" r="18" fill="#48bb78" stroke="white" stroke-width="2"/>
                <text x="350" y="236" text-anchor="middle" fill="white" font-weight="bold" font-size="16">3</text>
            </g>
            <g>
                <circle cx="600" cy="500" r="18" fill="#4299e1" stroke="white" stroke-width="2"/>
                <text x="600" y="506" text-anchor="middle" fill="white" font-weight="bold" font-size="16">4</text>
            </g>
            <g>
                <circle cx="600" cy="710" r="18" fill="#4299e1" stroke="white" stroke-width="2"/>
                <text x="600" y="716" text-anchor="middle" fill="white" font-weight="bold" font-size="16">5</text>
            </g>
            <g>
                <circle cx="870" cy="920" r="18" fill="#ed8936" stroke="white" stroke-width="2"/>
                <text x="870" y="926" text-anchor="middle" fill="white" font-weight="bold" font-size="16">6</text>
            </g>
            <g>
                <circle cx="280" cy="920" r="18" fill="#ed8936" stroke="white" stroke-width="2"/>
                <text x="280" y="926" text-anchor="middle" fill="white" font-weight="bold" font-size="16">7</text>
            </g>
        </svg>
        
        <div class="info-panel">
            <div class="info-card" style="background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);">
                <h3>üéØ Key Benefits</h3>
                <ul>
                    <li>Non-blocking audit (doesn't slow chat)</li>
                    <li>Decoupled services (fault isolation)</li>
                    <li>Scalable architecture</li>
                    <li>Cost-effective storage (Blob for large data)</li>
                    <li>Fast queries (PostgreSQL for metadata)</li>
                    <li>API keys secured server-side</li>
                </ul>
            </div>
            
            <div class="info-card" style="background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);">
                <h3>‚ö° Data Flow Steps</h3>
                <ul>
                    <li><strong>Step 1-3:</strong> User request ‚Üí Stream response</li>
                    <li><strong>Step 4:</strong> Async event to message queue</li>
                    <li><strong>Step 5:</strong> Audit service consumes event</li>
                    <li><strong>Step 6:</strong> Upload full chat to Blob</li>
                    <li><strong>Step 7:</strong> Store metadata in PostgreSQL</li>
                </ul>
            </div>
            
            <div class="info-card" style="background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);">
                <h3>üíæ Storage Strategy</h3>
                <ul>
                    <li><strong>PostgreSQL:</strong> Metadata, IDs, timestamps</li>
                    <li><strong>Azure Blob:</strong> Full conversations (JSON)</li>
                    <li><strong>Why Hybrid?</strong> Fast queries + cheap storage</li>
                    <li><strong>Retention:</strong> Easy to archive old blobs</li>
                    <li><strong>Compliance:</strong> Separate data stores</li>
                </ul>
            </div>
            
            <div class="info-card" style="background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%);">
                <h3>üõ†Ô∏è Tech Stack</h3>
                <ul>
                    <li><strong>Frontend:</strong> React, Axios, EventSource</li>
                    <li><strong>Backend:</strong> Quarkus, SmallRye Messaging</li>
                    <li><strong>Queue:</strong> Kafka / RabbitMQ</li>
                    <li><strong>DB:</strong> PostgreSQL 14+, Hibernate</li>
                    <li><strong>Storage:</strong> Azure Blob SDK for Java</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>
